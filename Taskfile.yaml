# https://taskfile.dev



version: '3'

vars:
  GREETING: Hello, World!
env:
  TF_VAR_GCP_ORGANIZATION_ID: 
        sh: gcloud organizations list --format=json | jq -r '.[0].name | split("/") | .[1]' ##gcloud auth: https://stackoverflow.com/questions/53306131/difference-between-gcloud-auth-application-default-login-and-gcloud-auth-logi

tasks:
  auth:
    desc: Authenticate with GCP. This must be run before gke_up and/or gke_destroy
    cmds:
      - gcloud init --console-only
      - gcloud auth application-default login --no-launch-browser

  gke_up:
    desc: Brings up GKE Cluster
    cmds:
      - terraform init
      - terraform apply --auto-approve

  
  gke_destroy:
    desc: Destroys GKE Cluster
    cmds:
      - terraform init
      - terraform destroy --auto-approve

